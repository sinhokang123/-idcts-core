"""
IDCTS ë¬¸ì„œ ìƒì„± ëª¨ë“ˆ v2.1
"""

from datetime import datetime
from typing import Optional


def generate_summary_report(
    case_id: str,
    target_url: str,
    domain_list: list[str],
    cdn_classification: dict,
    detected_cdn: str,
    whois_info: Optional[dict],
    content_classification: Optional[dict] = None,
    risk_score: int = 0,
    risk_level: str = "UNKNOWN",
    risk_recommendation: str = "",
    takedown_priority: Optional[list] = None,
    timeline: Optional[dict] = None,
) -> str:
    """ê¸°ê´€ í‘œì¤€ ë¶„ì„ ë³´ê³ ì„œ ìƒì„±"""
    
    now = datetime.now()
    timestamp = now.strftime("%Y-%m-%d %H:%M:%S KST")
    
    level_emoji = {
        "CRITICAL": "ðŸ”´",
        "HIGH": "ðŸŸ ", 
        "MEDIUM": "ðŸŸ¡",
        "LOW": "ðŸŸ¢"
    }.get(risk_level, "âšª")
    
    report = f"""################################################################################
#                                                                              #
#                    IDCTS ë¶„ì„ ë³´ê³ ì„œ (Summary Report) v2.1                    #
#                         ê¸°ê´€ ì œì¶œìš© í‘œì¤€ë³¸                                    #
#                                                                              #
################################################################################

================================================================================
1. ì¼€ì´ìŠ¤ ì •ë³´
================================================================================

  Case ID      : {case_id}
  ë¶„ì„ ì¼ì‹œ    : {timestamp}
  ëŒ€ìƒ URL     : {target_url}
  ë¶„ì„ ë²„ì „    : IDCTS Core v2.1

================================================================================
2. ìœ„í—˜ë„ í‰ê°€ (Risk Assessment)
================================================================================

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                             â”‚
  â”‚   {level_emoji} Risk Score: {risk_score}/100 ({risk_level})
  â”‚                                                             â”‚
  â”‚   â–¶ ê¶Œê³  ì¡°ì¹˜:                                              â”‚
  â”‚   {risk_recommendation[:55] if risk_recommendation else 'N/A'}
  â”‚                                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â–  ëŒ€ì‘ ìš°ì„ ìˆœìœ„: {'ì¦‰ì‹œ ëŒ€ì‘ í•„ìš”' if risk_score >= 70 else 'ì¼ë°˜ ëŒ€ì‘'}
  â–  ì˜ˆìƒ ì²˜ë¦¬ ë‚œì´ë„: {'ë†’ìŒ' if detected_cdn == 'Unknown' else 'ë³´í†µ'}

================================================================================
3. ì½˜í…ì¸  ë¶„ë¥˜ ê²°ê³¼
================================================================================
"""
    
    if content_classification:
        report += f"""
  â–  ì½˜í…ì¸  ìœ í˜•: {content_classification.get('category_name', 'Unknown')}
  â–  ë¶„ë¥˜ ì½”ë“œ: {content_classification.get('category', 'UNKNOWN')}
  â–  ì‹ ë¢°ë„: {content_classification.get('confidence', 'LOW')}
  â–  ë¯¸ë””ì–´ ìœ í˜•: {content_classification.get('media_type', 'unknown')}
  
  â–  ë¶„ë¥˜ ê·¼ê±°:
"""
        for reason in content_classification.get('reasons', []):
            report += f"    - {reason}\n"
    else:
        report += "\n  ì½˜í…ì¸  ë¶„ë¥˜ ì •ë³´ ì—†ìŒ\n"
    
    report += f"""
================================================================================
4. CDN/ì¸í”„ë¼ ë¶„ì„ ê²°ê³¼
================================================================================

  â–  ì£¼ìš” CDN: {detected_cdn}
  â–  CDNë³„ ë„ë©”ì¸ í˜„í™©:
"""
    
    for cdn_name, domains in cdn_classification.items():
        report += f"\n    [{cdn_name}] ({len(domains)}ê°œ)\n"
        for d in domains[:5]:
            report += f"      - {d}\n"
        if len(domains) > 5:
            report += f"      ... ì™¸ {len(domains) - 5}ê°œ\n"
    
    report += f"""
================================================================================
5. ê´€ë ¨ ë„ë©”ì¸ ëª©ë¡ (ì´ {len(domain_list)}ê°œ)
================================================================================
"""
    
    for i, domain in enumerate(domain_list[:20], 1):
        report += f"  {i:3}. {domain}\n"
    if len(domain_list) > 20:
        report += f"  ... ì™¸ {len(domain_list) - 20}ê°œ ë„ë©”ì¸\n"
    
    report += """
================================================================================
6. WHOIS ì •ë³´
================================================================================
"""
    
    if whois_info:
        report += f"""
  ë“±ë¡ê¸°ê´€     : {whois_info.get('registrar', 'None')}
  êµ­ê°€         : {whois_info.get('country', 'None')}
  ì¡°ì§         : {whois_info.get('org', 'None')}
  Abuse ì´ë©”ì¼ : {whois_info.get('emails', 'None')}
  ìƒì„±ì¼       : {whois_info.get('creation_date', 'None')}
  ë§Œë£Œì¼       : {whois_info.get('expiration_date', 'None')}
"""
    else:
        report += "\n  WHOIS ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n"
    
    if takedown_priority:
        report += """
================================================================================
7. ì‹ ê³  ëŒ€ìƒ ìš°ì„ ìˆœìœ„
================================================================================
"""
        for i, p in enumerate(takedown_priority, 1):
            report += f"""
[{i}ìˆœìœ„] {p.get('type', 'Unknown')}: {p.get('target', 'N/A')}
    ë‚œì´ë„: {p.get('difficulty', 'UNKNOWN')}
    ì—°ë½ì²˜: {p.get('contact', 'N/A')}
    ê¶Œê³  ì¡°ì¹˜: {p.get('action', 'N/A')}
"""
    
    report += f"""
================================================================================
8. ê¶Œê³  ì¡°ì¹˜ (Recommended Actions)
================================================================================

  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  â–¶ í•µì‹¬ ê¶Œê³ : í•´ì™¸ CDN/í˜¸ìŠ¤íŒ… ì‚¬ì—…ìž ëŒ€ìƒ ìš°ì„ ì  ì‚­ì œ ìš”ì²­ì„ ê¶Œê³ í•¨        â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  [1ë‹¨ê³„] ì¦ê±° ë³´ì¡´ (ì¦‰ì‹œ)
  [2ë‹¨ê³„] CDN/í˜¸ìŠ¤íŒ… ì‹ ê³  (24-48ì‹œê°„ ë‚´)
  [3ë‹¨ê³„] ë„ë©”ì¸ ë“±ë¡ê¸°ê´€ ì‹ ê³  (48-72ì‹œê°„ ë‚´)
  [4ë‹¨ê³„] ê´€ê³„ ê¸°ê´€ ì‹ ê³  (ë³‘í–‰)
  [5ë‹¨ê³„] ëª¨ë‹ˆí„°ë§ (ì§€ì†)

================================================================================
9. ì£¼ì˜ì‚¬í•­ ë° ë©´ì±…ì¡°í•­
================================================================================

  â€» ë³¸ ë³´ê³ ì„œëŠ” ìžë™ ë¶„ì„ ê²°ê³¼ì´ë©°, ë²•ì  íš¨ë ¥ì„ ê°–ëŠ” ê³µì‹ ë¬¸ì„œê°€ ì•„ë‹™ë‹ˆë‹¤.
  â€» ë³¸ ì‹œìŠ¤í…œì€ ì½˜í…ì¸ ë¥¼ ì§ì ‘ ì‚­ì œí•˜ì§€ ì•Šìœ¼ë©°, ë¶„ì„ ë° ë¬¸ì„œ ìƒì„±ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.

################################################################################
#          Generated by IDCTS Core v2.1 - AboutUs Digital Undertaker          #
################################################################################
"""
    
    return report


def generate_legal_statement(
    case_id: str,
    target_url: str,
    domain_list: list[str],
    risk_score: int = 0,
    risk_level: str = "UNKNOWN",
) -> str:
    """ë²•ì  ì§„ìˆ ì„œ"""
    
    now = datetime.now()
    date_str = now.strftime("%Yë…„ %mì›” %dì¼")
    
    return f"""################################################################################
#                         ë²•ì  ì§„ìˆ ì„œ (Legal Statement)                         #
################################################################################

ì‚¬ê±´ ë²ˆí˜¸: {case_id}
ìž‘ì„± ì¼ìž: {date_str}
ìœ„í—˜ë„ í‰ê°€: {risk_score}ì  ({risk_level})

================================================================================
1. ë‹¹ì‚¬ìž ì •ë³´
================================================================================

ì§„ìˆ ì¸ ì„±ëª…: ______________________________
ìƒë…„ì›”ì¼: ______________________________
ì—°ë½ì²˜: ______________________________

================================================================================
2. ëŒ€ìƒ ì½˜í…ì¸  ì •ë³´
================================================================================

ëŒ€ìƒ URL: {target_url}
ê´€ë ¨ ë„ë©”ì¸ ìˆ˜: {len(domain_list)}ê°œ

================================================================================
3. ì§„ìˆ  ë‚´ìš©
================================================================================

ë³¸ì¸ì€ ìœ„ URLì— ê²Œì‹œëœ ì½˜í…ì¸ ê°€ ë³¸ì¸ì˜ ë™ì˜ ì—†ì´ ì´¬ì˜/ìœ í¬ëœ ê²ƒìž„ì„ 
ì§„ìˆ í•©ë‹ˆë‹¤.

================================================================================
4. ë™ì˜ ë° ì„œëª…
================================================================================

ì„œëª…: ______________________________
ë‚ ì§œ: {date_str}

################################################################################
"""


def generate_dmca_abuse_notice(
    case_id: str,
    target_url: str,
    domain_list: list[str],
    detected_cdn: str,
    content_type: str = "Unknown",
    risk_score: int = 0,
    risk_level: str = "UNKNOWN",
) -> str:
    """DMCA/Abuse Notice"""
    
    now = datetime.now()
    date_str = now.strftime("%Y-%m-%d")
    urgency = "URGENT" if risk_score >= 70 else "STANDARD"
    
    return f"""################################################################################
#                    DMCA TAKEDOWN NOTICE / ABUSE REPORT                       #
################################################################################

Case Reference: {case_id}
Date: {date_str}
Priority: {urgency} (Risk Score: {risk_score}/100)

================================================================================
INFRINGING CONTENT LOCATION
================================================================================

Primary URL: {target_url}
CDN Provider: {detected_cdn}
Associated Domains: {len(domain_list)} total

================================================================================
NATURE OF VIOLATION
================================================================================

Content Type: {content_type}
Risk Assessment: {risk_level} ({risk_score}/100)

[X] Non-consensual intimate imagery (NCII)
[X] Violation of privacy rights

================================================================================
REQUESTED ACTION
================================================================================

a) Immediately remove or disable access to the infringing content
b) Preserve all associated metadata and logs
c) Provide confirmation within {'24' if risk_score >= 70 else '48'} hours

================================================================================
CONTACT INFORMATION
================================================================================

Name: [YOUR NAME]
Email: [YOUR EMAIL]
Organization: [YOUR ORGANIZATION]

================================================================================
SIGNATURE
================================================================================

Signature: _________________________
Date: {date_str}

################################################################################
"""
